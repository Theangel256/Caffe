---


const { id } = Astro.params;
const data = await fetch(`${Astro.env.PUBLIC_URL}/api/dashboard/${id}`).then(r => r.json());

const db = data.db;
const statusCounts = data.statuses;
const bans = data.bans;
import Head from "../../../components/_head.astro";
//import PanelHeader from "../../../../components/PanelHeader.astro";
//<PanelHeader guild={guild} user={user} />
import PanelData from '../../../components/PanelData.astro';
import PanelOpciones from "../../../components/PanelOpciones.astro";

// Authentication
const user = Astro.locals?.user;
if (!user) return Astro.redirect("/signin");

// Get guild data from your bot client (you can replace this with a fetch)
const bot = globalThis.client;
const guild = bot?.guilds.cache.get(id) ?? await bot.guilds.fetch(id).catch(() => null);

if (!guild) return Astro.redirect("/error404");
---

<!DOCTYPE html>
<html lang="es">
  <Head title={`Caffe Dashboard - ${guild.name}`} />
  <body data-spy="scroll" data-target="#data">
    <PanelData guild={guild} bans={bans} statusCounts={statusCounts} />
    <PanelOpciones guild={guild} />
    <script src="/hidden.js"></script>
  </body>
</html>

