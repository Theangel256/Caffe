---


const { id } = Astro.params;
const data = await fetch(`/api/dashboard/${id}`).then(r => r.json());

const db = data.db;
const statusCounts = data.statuses;
const bans = data.bans;
import Head from "../../../components/_head.astro";
//import PanelHeader from "../../../../components/PanelHeader.astro";
//<PanelHeader guild={guild} user={user} />
import PanelData from '../../../components/PanelData.astro';
import PanelOpciones from "../../../components/PanelOpciones.astro";
import Navbar from "../../../components/navbar.astro";

// Authentication
const user = Astro.locals?.user;
if (!user) return Astro.redirect("/signin");

// Get guild data from your bot client (you can replace this with a fetch)
const bot = globalThis.client;
const guild = bot?.guilds.cache.get(id) ?? await bot.guilds.fetch(id).catch(() => null);

if (!guild) return Astro.redirect("/error404");
---

<!DOCTYPE html>
<html lang="es">
  <Head title={`Caffe Dashboard - ${guild.name}`} />
  <Navbar></Navbar>
  <body data-spy="scroll" data-target="#data">
    <PanelData guild={guild} bans={bans} statusCounts={statusCounts} />
    <PanelOpciones guild={guild} />
    <script src="/hidden.js"></script>
  </body>
</html>

---
const { id } = Astro.params;
const res = await fetch(`/api/dashboard/${id}`);
const data = await res.json();
---

<h1>{data.guild.name}</h1>
<p>Miembros: {data.guild.memberCount}</p>
<p>Canales: {data.guild.channels}</p>
<p>Roles: {data.guild.roles}</p>
