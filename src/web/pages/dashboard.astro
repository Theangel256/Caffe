---
const user = Astro.locals.user;
if (!user) return Astro.redirect('/signin');

const guilds = user.guilds?.filter(g => (g.permissions & 8) === 8) || [];

---

<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Caffe - Dashboard</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>

<body class="body-index">
  
    <nav>
      <a href="/">Home</a>
      <a href="/dashboard">Dashboard</a>
    </nav>
    <div class="user-info">
        <h2>Welcome back, {user.username}!</h2>
      <img src={`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`} alt={user.username} />
    </div>
  <center>
    <div class="container-fluid">
      <section class="body-header">
        <div>
          <h1><b>PLEASE SELECT A SERVER</b></h1><br>
        </div>
        { guilds.map(dato => {
        <a class="navbar-brand" 
        data-toggle="tooltip" 
        data-placement="bottom" 
        title={dato.name}
        href={`/dashboard/${dato.id}`}>
        if(dato.icon) {
          <img class="Server-select responsive-img"
            src={`https://cdn.discordapp.com/icons/${dato.id}/${dato.icon}.png`} alt={dato.name} />
        } else {
        <img class="Server-select responsive-img"
          src="https://discordapp.com/assets/6debd47ed13483642cf09e832ed0bc1b.png" alt={dato.name} />
         }
        </a>
        })
      }
    </div>
    </section>
    </div>
  </center>
</body>

</html>
<script src="/tooltip.js"></script>